<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>voice</title>
<style>
    body {
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #circle {
        width: 50vh;
        height: 50vh;

        background-color: #818181;
        border-radius: 50%;
        display: flex;
    }
    #text {
        font-size: 32px;
        margin: auto;
        font-family: Helvetica, Arial, sans-serif;
    }
</style>
</head>

<body>
    <div id="circle"><div id="text"></div></div>
<script>
    navigator.mediaDevices.getUserMedia({audio: true})
        .then(function(stream) {
            var AudioContext = window.AudioContext || window.webkitAudioContext; 
            audioContext = new AudioContext();
            analyser = audioContext.createAnalyser();
            microphone = audioContext.createMediaStreamSource(stream);
            proc = audioContext.createScriptProcessor(2048, 1, 1);


            microphone.connect(analyser);
            analyser.connect(proc);
            proc.connect(audioContext.destination);
            var averaging = 0.95;
            var volume = 0;
            proc.onaudioprocess = function(event) {
                var buf = event.inputBuffer.getChannelData(0);
                var bufLength = buf.length;
                var sum = 0;
                var x;
                for (var i=0; i<bufLength; i++) {
                    x = buf[i];
                    sum += x * x;
                }
                var rms =  Math.sqrt(sum / bufLength);
                volume = Math.max(rms, volume*averaging);
                var val = (Math.round(100*volume))                
                if (val > 20) {
                    document.getElementById('circle').style.backgroundColor = '#DA0000';
                } else if (val > 10) {                
                    document.getElementById('circle').style.backgroundColor = '#ECDC28';
                } else {                
                    document.getElementById('circle').style.backgroundColor = '#1FAB08';
                }
                document.getElementById('text').innerHTML = val;

            }
        }).catch(function(err) {
            alert(err);
        });
</script>

</body>

</html>